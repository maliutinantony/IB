Infiniband – это высокоскоростная сеть, часто используемая для взаимодействия кластерных систем и высокопроизводительных вычислительных систем. Для проверки соединения и количества хопов между двумя серверами можно использовать utility `ibtracert` или `ibnetdiscover`.

Вот пример шагов и команд:

1. **Получить базовую информацию о сети:**
   
   Это можно сделать с помощью `ibnetdiscover`:
   
   ```sh
   sudo ibnetdiscover > /tmp/ibnetdiscover.out
   cat /tmp/ibnetdiscover.out
   ```

2. **Получить LID (Local Identifier), GUID (Globally Unique Identifier) или IPoIB адрес каждого из серверов:**

   LID можно узнать с помощью команды `ibstat`:

   ```sh
   ibstat
   ```

   Или напрямую узнать IPoIB интерфейс:

   ```sh
   ifconfig
   ```

   Конкретно для получения GUID:

   ```sh
   cat /sys/class/infiniband/mlx5_0/ports/1/gid_attrs/ndevs/0/npf/gid_attrs/GID_tbl0
   ```

3. **Проверить количество хопов с помощью `ibtracert`:**

   Используйте LID серверов для определения маршрута и количества хопов между ними.

   ```sh
   sudo ibtracert <LID_сервера_1> <LID_сервера_2>
   ```

   Например:

   ```sh
   sudo ibtracert 0x1 0x2
   ```

   Результаты команды покажут путь и количество хопов между двумя серверами.

4. **Проверить связь с определенного хоста (с использованием IPoIB):**

   Если у вас настроен IPoIB, вы можете использовать `ping`:

   ```sh
   ping <IP_сервера_2>
   ```

5. **Поиск в таблицах маршрутизации:**

   Обычно маршруты хранятся в Subnet Manager (SM). Убедитесь, что управляющий демон SM активен, например OpenSM:

   ```sh
   sudo systemctl status opensm
   ```

Использование этих команд должно позволить вам определить, как сервера соединены и через сколько хопов они общаются в сети Infiniband.
